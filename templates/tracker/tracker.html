{% extends 'tracker/base.html' %}
{% load static %}
{% block title %}Маршрути{% endblock %}
{% block head %}
    <link rel="stylesheet" href="{% static 'tracker/css/css_tracker_maps.css' %}">
    <script>
        var start;
        var map;
        start = {
            lat: parseFloat('{{  ob.user_id.position_lat }}'.replace(",", ".")),
            lng: parseFloat('{{ ob.user_id.position_long  }}'.replace(",", "."))
        };
        if (navigator.userAgent.search(/Firefox/) > 0) {
            navigator.geolocation.getCurrentPosition(function (position) {
                start = {lat: position.coords.latitude, lng: position.coords.longitude};
            });
        }
        var end = {
            lat: parseFloat('{{ ob.place_id.position_lat }}'.replace(",", ".")),
            lng: parseFloat('{{ ob.place_id.position_long }}'.replace(",", "."))
        };
        function initMap() {

            map = new google.maps.Map(document.getElementById('map'), {
                center: end,
                scrollwheel: true,
                zoom: 7
            });
        }
        function directions(map) {
            var directionsDisplay = new google.maps.DirectionsRenderer({
                map: map
            });
            var directionsService = new google.maps.DirectionsService;
            directionsDisplay.setMap(map);
            directionsDisplay.setPanel(document.getElementById('right-panel'));
            // Set destination, origin and travel mode.
            var request = {
                destination: end,
                origin: start,
                travelMode: google.maps.TravelMode.TRANSIT

            };
            // Pass the directions request to the directions service.
            var directionsService = new google.maps.DirectionsService();
            directionsService.route(request, function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    // Display the route on the map.
                    directionsDisplay.setDirections(response);
                }
            });
        }
        $(document).ready(function () {
            $("#builder").click(function () {
                directions(map);
                setTimeout(function () {
                    $('.adp-warnbox').fadeOut(2000);
                }, 5000);
            })
        });

    </script>
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
            <div id="map"></div>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-0">
            <div id="right-panel"></div>
        </div>
    </div>
    <br/>
    <button type="button" class="btn btn-default" id="builder">Пободувати маршрут</button>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBT-WN94rBusbT5l4fv-8dKkMhx-iqN3wI&language=uk&callback=initMap"
    ></script>
    <script>initMap()</script>
{% endblock %}